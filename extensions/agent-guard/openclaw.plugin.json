{
  "id": "agent-guard",
  "name": "Agent Message Guard",
  "description": "Scans inter-agent sessions_send messages for prompt injection using a local DeBERTa ONNX model. Three-tier response: pass, warn (inject advisory), or block. No API key required — model is downloaded on first use and cached locally.",
  "version": "0.1.0",
  "configSchema": {
    "type": "object",
    "additionalProperties": false,
    "properties": {
      "sensitivity": {
        "type": "number",
        "minimum": 0,
        "maximum": 1,
        "default": 0.5,
        "description": "Detection threshold (0.0–1.0). Lower = more aggressive (fewer false negatives, more false positives)."
      },
      "warnThreshold": {
        "type": "number",
        "minimum": 0,
        "maximum": 1,
        "default": 0.4,
        "description": "Score above which to inject a security warning into the agent context."
      },
      "blockThreshold": {
        "type": "number",
        "minimum": 0,
        "maximum": 1,
        "default": 0.8,
        "description": "Score above which to hard-block the message entirely."
      },
      "failOpen": {
        "type": "boolean",
        "default": false,
        "description": "If true, allow messages when model is unavailable. If false (default), block on model failure."
      },
      "cacheDir": {
        "type": "string",
        "description": "Directory to cache the ONNX model. Defaults to @huggingface/transformers default cache location."
      },
      "logDetections": {
        "type": "boolean",
        "default": true,
        "description": "Log flagged messages (score, source, snippet) to the gateway console."
      },
      "guardAgents": {
        "type": "array",
        "items": { "type": "string" },
        "default": [],
        "description": "Agent IDs to scan. Empty = scan all agents."
      },
      "skipTargetAgents": {
        "type": "array",
        "items": { "type": "string" },
        "default": [],
        "description": "Target agent IDs to skip scanning. Messages to these agents are always allowed."
      }
    }
  },
  "uiHints": {
    "sensitivity": { "label": "Sensitivity" },
    "warnThreshold": { "label": "Warn Threshold" },
    "blockThreshold": { "label": "Block Threshold" },
    "failOpen": { "label": "Fail Open" },
    "cacheDir": { "label": "Model Cache Dir" },
    "logDetections": { "label": "Log Detections" },
    "guardAgents": { "label": "Guard Agents" },
    "skipTargetAgents": { "label": "Skip Target Agents" }
  }
}
